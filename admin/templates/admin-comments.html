{% extends "base-admin.html" %}

{% block title %}Comments - Admin{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <div>
            <h1>Comments</h1>
            <p>Monitor and manage blog comments</p>
        </div>
    </div>

    <div class="dashboard-section">
        <div class="table-responsive">
            {% if comments.items %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Author</th>
                        <th>Comment</th>
                        <th>Blog Post</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for comment in comments.items %}
                    <tr>
                        <td>
                            <strong>{{ comment.author_name }}</strong><br>
                            <small>{{ comment.author_email }}</small>
                        </td>
                        <td>
                            <div class="comment-preview">
                                {{ comment.content }}
                            </div>
                        </td>
                        <td>
                            <a href="{{ url_for('blog_post', slug=comment.blog.slug) }}" target="_blank">
                                {{ comment.blog.title[:40] }}{% if comment.blog.title|length > 40 %}...{% endif %}
                            </a>
                        </td>
                        <td>{{ comment.created_at.strftime('%b %d, %Y') }}</td>
                        <td class="actions">
                            <button class="btn-icon btn-warning" onclick="markSpam({{ comment.id }})" title="Mark as Spam">
                                <i class="fas fa-flag"></i>
                            </button>
                            <button class="btn-icon btn-danger" onclick="deleteComment({{ comment.id }})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Pagination -->
            {% if comments.pages > 1 %}
            <div class="pagination">
                {% if comments.has_prev %}
                <a href="{{ url_for('admin.comments', page=comments.prev_num) }}" class="btn btn-outline">← Previous</a>
                {% endif %}
                
                <span class="page-info">Page {{ comments.page }} of {{ comments.pages }}</span>
                
                {% if comments.has_next %}
                <a href="{{ url_for('admin.comments', page=comments.next_num) }}" class="btn btn-outline">Next →</a>
                {% endif %}
            </div>
            {% endif %}
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h3>No Comments Yet</h3>
                <p>Comments will appear here when users post them.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');

function markSpam(commentId) {
    if (confirm('Mark this comment as spam and hide it?')) {
        fetch(`/admin/comment/${commentId}/spam`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}
</script>

<style>
.filter-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid #e0e0e0;
}

.tab {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    color: #666;
    text-decoration: none;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    position: relative;
    bottom: -2px;
}

.tab:hover {
    color: #0066cc;
}

.tab.active {
    color: #0066cc;
    border-bottom-color: #0066cc;
}

.comment-preview {
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.4;
}

.actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: #999;
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    opacity: 0.5;
}
</style>
{% endblock %}
